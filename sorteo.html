<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mesas Millonarias - Sorteo</title>
    <style id="estilos-dinamicos">
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #0d1a26;
            color: #ecf0f1;
            margin: 0;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            overflow: hidden;
            cursor: pointer;
        }
        .imagen-esquina {
            position: absolute;
            top: 0; /* Pegado al borde superior */
            width: auto;
            height: 90px; /* Altura de la imagen */
            z-index: 1; /* Se posiciona detr√°s del contenedor del sorteo */
        }
        .imagen-izquierda {
            left: 0; /* Pegado al borde izquierdo */
        }
        .imagen-derecha {
            right: 0; /* Pegado al borde derecho */
        }
        .contenedor-sorteo {
            background-color: rgba(31, 50, 70, 0.9);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            max-width: 80vw;
            width: 100%;
            border: 2px solid #34495e;
            z-index: 2; /* Se asegura de que est√© por encima de las im√°genes */
        }
        h1 {
            color: #f39c12; margin-bottom: 20px; font-size: 3em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.6);
            animation: neon-glow 2s ease-in-out infinite alternate;
        }
        @keyframes neon-glow {
            from { text-shadow: 0 0 5px #f39c12, 0 0 10px #f39c12, 0 0 15px #f39c12; }
            to { text-shadow: 0 0 10px #f39c12, 0 0 20px #f39c12, 0 0 30px #f39c12, 0 0 40px #f39c12; }
        }
        #resultado-sorteo {
            min-height: 150px; display: flex; flex-direction: column; justify-content: center; align-items: center;
            font-size: 2.5em; font-weight: bold; background-color: rgba(52, 73, 94, 0.8);
            border-radius: 10px; padding: 20px; border: 2px dashed #95a5a6;
            transition: all 0.5s ease; box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.4);
        }
        #resultado-sorteo p { margin: 0; line-height: 1.5; }
        #premio-mensaje, #condicion-mensaje {
            font-size: 1.2em; font-weight: bold; margin-top: 15px;
            opacity: 0; animation: fadeIn 1s forwards; color: #2ecc71;
        }
        #condicion-mensaje { font-size: 1em; font-weight: normal; color: #ecf0f1; margin-top: 5px; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .resultado-ganador { animation: iluminar-border 1.5s infinite alternate; border: 2px solid #f39c12; }
        @keyframes iluminar-border { from { box-shadow: 0 0 5px #f39c12; } to { box-shadow: 0 0 20px #f39c12, 0 0 30px #f39c12; } }
        .girando::before {
            display: block; font-size: 2.5em; animation: intercalar-iconos 0.8s linear infinite; line-height: 1;
        }
        @keyframes intercalar-iconos {
            0%, 100% { content: 'üé∞'; transform: rotate(0deg); opacity: 1; }
            49% { content: 'üé∞'; transform: rotate(180deg); opacity: 0.8; }
            50% { content: 'üÉè'; transform: rotate(180deg); opacity: 0.2; }
            51% { content: 'üÉè'; transform: rotate(180deg); opacity: 0.8; }
        }
        .confetti-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; overflow: hidden; }
        .confetti { position: absolute; width: 8px; height: 8px; background-color: #f39c12; animation: fall 5s linear infinite; top: -20px; left: 50%; transform: translateX(-50%) rotate(0deg); will-change: transform, opacity; }
        @keyframes fall {
            0% { transform: translateX(var(--x)) translateY(0) rotate(var(--deg)); opacity: 1; }
            100% { transform: translateX(var(--x-end)) translateY(110vh) rotate(var(--deg-end)); opacity: 0; }
        }
    </style>
</head>
<body>
    <!-- ========= IM√ÅGENES DE LAS ESQUINAS ========= -->
    <!-- Reemplaza el 'src' con la URL de tu imagen izquierda -->
    <img src="img/dreams1.png" alt="Logo Izquierda" class="imagen-esquina imagen-izquierda">
    
    <!-- Reemplaza el 'src' con la URL de tu imagen derecha -->
    <img src="img/dreams1.png" alt="Logo Derecha" class="imagen-esquina imagen-derecha">
    <!-- ============================================= -->

    <main class="contenedor-sorteo">
        <h1>Mesas Millonarias</h1>
        <div id="resultado-sorteo">
            <p>Haz clic para iniciar el sorteo.</p>
        </div>
    </main>
    <div id="confetti-container" class="confetti-container"></div>
    <script>
        const cssSheet = document.getElementById('estilos-dinamicos');
        const divResultado = document.getElementById('resultado-sorteo');
        const confettiContainer = document.getElementById('confetti-container');
        let sorteoEnCurso = false;
        let confettiInterval;
        let ultimoColorGanador = '';
        let datosSorteo = {};

        const formatColorName = (name) => { if (typeof name !== 'string') return ''; return name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/\s+/g, '-'); };
        const generarClasesColores = (colorName, hexCode) => { const formattedName = formatColorName(colorName); if(hexCode && !cssSheet.innerHTML.includes(`.color-${formattedName}`)){ cssSheet.innerHTML += ` .color-${formattedName} { color: ${hexCode} !important; text-shadow: 0 0 2px ${hexCode}; animation: iluminar-color-${formattedName} 1.5s infinite alternate; } @keyframes iluminar-color-${formattedName} { from { text-shadow: 0 0 5px ${hexCode}, 0 0 10px ${hexCode}; } to { text-shadow: 0 0 15px ${hexCode}, 0 0 25px ${hexCode}; } }`; } };
        const cargarDatos = () => { const storedData = localStorage.getItem('mesasMillonariasData'); if (storedData) { datosSorteo = JSON.parse(storedData); if (datosSorteo.colorMap) { Object.entries(datosSorteo.colorMap).forEach(([key, value]) => { const originalName = Object.keys(datosSorteo.colorMap).find(k => formatColorName(k) === key) || key; generarClasesColores(originalName, value); }); } } else { divResultado.innerHTML = '<p style="color: #f39c12;">Esperando configuraci√≥n desde el panel de control...</p>'; } };
        const crearConfettiParticula = () => { const confetti = document.createElement('div'); confetti.classList.add('confetti'); const colors = ['#f39c12', '#e74c3c', '#3498db', '#2ecc71', '#9b59b6']; confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)]; confetti.style.setProperty('--x', `${(Math.random() - 0.5) * 150}vw`); confetti.style.setProperty('--x-end', `${(Math.random() - 0.5) * 200}vw`); confetti.style.setProperty('--deg', `${Math.random() * 360}deg`); confetti.style.setProperty('--deg-end', `${Math.random() * 360 * 2 + 360}deg`); const duration = Math.random() * 3 + 4; confetti.style.animationDuration = `${duration}s`; confetti.style.animationDelay = `-${Math.random() * duration}s`; confettiContainer.appendChild(confetti); confetti.addEventListener('animationend', () => confetti.remove()); };
        const iniciarConfetiContinuo = () => { for (let i = 0; i < 50; i++) crearConfettiParticula(); confettiInterval = setInterval(crearConfettiParticula, 100); };
        const detenerConfetiContinuo = () => { clearInterval(confettiInterval); confettiContainer.innerHTML = ''; };

        const realizarSorteo = () => {
            if (sorteoEnCurso) return;
            cargarDatos(); 
            if (!datosSorteo || !datosSorteo.checkedMesas) { divResultado.innerHTML = '<p style="color: #e74c3c;">Faltan datos. Guarda la configuraci√≥n en el panel de control.</p>'; return; }

            sorteoEnCurso = true;
            detenerConfetiContinuo();
            divResultado.classList.remove('resultado-ganador');
            divResultado.innerHTML = '<p>Realizando el sorteo...</p>';
            divResultado.classList.add('girando');

            const mesasEnJuego = datosSorteo.checkedMesas || [];
            if (mesasEnJuego.length === 0) {
                divResultado.innerHTML = '<p style="color: #e74c3c;">¬°Error! Debes seleccionar al menos una mesa en el panel de control.</p>';
                sorteoEnCurso = false; divResultado.classList.remove('girando'); return;
            }

            const ultimaMesaGanadora = mesasEnJuego[Math.floor(Math.random() * mesasEnJuego.length)];
            const tiempoSorteo = Math.floor(Math.random() * (5000 - 3000 + 1)) + 3000;

            setTimeout(() => {
                divResultado.classList.remove('girando');
                if (ultimaMesaGanadora.includes('Ruleta')) {
                    let coloresParaSortear;
                    // L√ìGICA CORREGIDA PARA USAR LISTAS SEPARADAS
                    if (ultimaMesaGanadora.includes('21') || ultimaMesaGanadora.includes('24') || ultimaMesaGanadora.includes('25')) {
                        coloresParaSortear = datosSorteo.checkedColores21 || [];
                    } else if (ultimaMesaGanadora.includes('22')) {
                        coloresParaSortear = datosSorteo.checkedColores22 || [];
                    } else if (ultimaMesaGanadora.includes('23')) {
                        coloresParaSortear = datosSorteo.checkedColores23 || [];
                    }
                    
                    if (!coloresParaSortear || coloresParaSortear.length === 0) { divResultado.innerHTML = `<p style="color: #e74c3c;">¬°Error! Faltan colores para la <strong>${ultimaMesaGanadora}</strong>.</p>`; sorteoEnCurso = false; return; }

                    ultimoColorGanador = coloresParaSortear[Math.floor(Math.random() * coloresParaSortear.length)];
                    divResultado.innerHTML = `<p>Mesa: <strong>${ultimaMesaGanadora}</strong><br>Color: <span class="color-${formatColorName(ultimoColorGanador)}"><strong>${ultimoColorGanador}</strong></span></p>`;
                } else {
                    const numeroGanador = Math.floor(Math.random() * 6) + 1;
                    ultimoColorGanador = '';
                    divResultado.innerHTML = `<p>Mesa: <strong>${ultimaMesaGanadora}</strong><br>Puesto: <span class="color-amarillo"><strong>${numeroGanador}</strong></span></p>`;
                }

                divResultado.classList.add('resultado-ganador');
                iniciarConfetiContinuo();
                sorteoEnCurso = false;

                if (window.opener && !window.opener.closed) {
                    window.opener.sorteoTerminado();
                }
            }, tiempoSorteo);
        };

        window.entregarPremio = function() { let premioElement = document.getElementById('premio-mensaje'); let condicionElement = document.getElementById('condicion-mensaje'); if (!premioElement) { premioElement = document.createElement('p'); premioElement.id = 'premio-mensaje'; divResultado.appendChild(premioElement); } if (!condicionElement) { condicionElement = document.createElement('p'); condicionElement.id = 'condicion-mensaje'; divResultado.appendChild(condicionElement); } premioElement.textContent = '¬°100.000 en Fichas Promocionales!'; premioElement.className = ''; premioElement.classList.add(ultimoColorGanador ? `color-${formatColorName(ultimoColorGanador)}` : 'color-amarillo'); condicionElement.textContent = 'Premio v√°lido con tarjeta del casino.'; };
        
        window.iniciarSorteoRemoto = function() {
            realizarSorteo();
        };

        document.body.addEventListener('click', realizarSorteo);

        document.addEventListener('DOMContentLoaded', () => {
            cargarDatos();
        });
    </script>
</body>
</html>


